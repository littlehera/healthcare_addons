[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2023-10-05 10:14:56.107828",
  "module": "Healthcare Add-ons",
  "name": "Sales Invoice - Healthcare Add-ons",
  "script": "frappe.ui.form.on('Sales Invoice', {\n\trefresh(frm) {\n\t\t// your code here\n\t},\n\tonload(frm){\n\t    practitioner_set_query(frm);\n\t    show_hide_ref_practitioner(frm);\n\t    if(frappe.user.has_role(\"Sales Manager\")){\n\t       frm.set_df_property(\"set_posting_time\", \"hidden\", 0);\n\t    }\n\t    else{\n\t        frm.set_df_property(\"set_posting_time\", \"hidden\", 1);\n\t    }\n\t}\n})\n\nfrappe.ui.form.on('Sales Invoice', 'ref_practitioner', function(frm){\n    reset_sales_partner(frm);\n    if(frm.doc.ref_practitioner)\n        frappe.call({\n            \"method\": \"frappe.client.get\",\n            \"args\":{\n                doctype: \"Healthcare Practitioner\",\n                name: frm.doc.ref_practitioner\n            },\n            \"callback\":function(data){\n                var practitioner_type = data.message['custom_type'];\n                var practitioner_name = data.message['practitioner_name'];\n                if(practitioner_type == 'Doctor (MD)'){\n                    practitioner_name += ', MD';\n                }\n                frm.set_value(\"custom_practitioner_name\",practitioner_name);\n                \n                if(frm.doc.custom_source.includes(\"Doctor's Referral\")||frm.doc.custom_source.includes(\"Promo\"))\n                    frm.set_value(\"sales_partner\",data.message['custom_sales_partner']);\n            }\n        });\n});\n\nfrappe.ui.form.on('Sales Invoice', 'custom_source', function(frm){\n   show_hide_ref_practitioner(frm);\n   \n   var si_source = frm.doc.custom_source;\n   if(si_source.includes(\"SC/PWD\")){\n        frm.set_value(\"additional_discount_percentage\",20);\n   }\n   else if(si_source.includes(\"MD\")){\n        frm.set_value(\"additional_discount_percentage\",10);\n   }\n   else{\n       frm.set_value(\"additional_discount_percentage\",0);\n   }\n});\n\nfrappe.ui.form.on('Sales Invoice', 'custom_hmo', function(frm){\n    if(frm.doc.custom_hmo)\n        frappe.call({\n            \"method\": \"frappe.client.get\",\n            \"args\":{\n                doctype: \"HMO\",\n                name: frm.doc.custom_hmo\n            },\n            \"callback\":function(data){\n                var price_list = data.message['price_list'];\n                \n                frm.set_value(\"selling_price_list\",price_list);\n            }\n        });\n});\n\nfrappe.ui.form.on(\"Sales Invoice\", \"custom_source\", function(frm) {\n        practitioner_set_query(frm);\n    \n});\n\nfunction practitioner_set_query(frm){\n    \n    var filters = {};\n    \n    if(frm.doc.custom_source.includes(\"Doctor's Referral\")||frm.doc.custom_source.includes(\"Promo\")){\n        filters = {\"custom_type\": \"Doctor (MD)\"}\n    }\n\n    frm.set_query(\"ref_practitioner\", function() {\n        return {\n            \"filters\": filters\n        };\n    });\n}\n\nfunction show_hide_ref_practitioner(frm){\n    if(frm.doc.custom_source.includes(\"Doctor's Referral\") ||frm.doc.custom_source.includes(\"Promo\")){\n        frm.set_df_property(\"ref_practitioner\", \"hidden\", 0);\n        frm.set_df_property(\"ref_practitioner\", \"read_only\", 0);\n        if(!frm.doc.custom_source.includes(\"Promo\")){\n            frm.set_df_property(\"custom_practitioner_name\", \"reqd\", 1);\n            frm.set_df_property(\"ref_practitioner\", \"reqd\", 1);\n        }\n        else{\n            frm.set_df_property(\"custom_practitioner_name\", \"reqd\", 0);\n            frm.set_df_property(\"ref_practitioner\", \"reqd\", 0);\n        }\n        \n        frm.set_df_property(\"custom_practitioner_name\", \"hidden\", 0);\n        frm.set_df_property(\"custom_practitioner_name\", \"read_only\", 0);\n        \n    }\n    else{\n        frm.set_value(\"ref_practitioner\",\"\")\n        frm.set_df_property(\"ref_practitioner\", \"hidden\", 1);\n        frm.set_df_property(\"ref_practitioner\", \"read_only\", 1);\n        frm.set_df_property(\"ref_practitioner\", \"reqd\", 0);\n        frm.set_value(\"custom_practitioner_name\",\"\")\n        frm.set_df_property(\"custom_practitioner_name\", \"hidden\", 1);\n        frm.set_df_property(\"custom_practitioner_name\", \"read_only\", 1);\n        frm.set_df_property(\"custom_practitioner_name\", \"reqd\", 0);\n    }\n}\n\nfunction reset_sales_partner(frm){\n    frm.set_value(\"commission_rate\",0)\n    frm.set_value(\"total_commission\",0)    \n}",
  "view": "Form"
 }
]